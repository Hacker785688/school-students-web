<?php
include 'db.php';

$type = $_POST['type'] ?? null;
$name = $_POST['name'] ?? 'Anonymous';
$message = $_POST['message'] ?? null;

if (!$type || !$message) {
    http_response_code(400);
    exit("Invalid input");
}

// Map form type to table
$tables = [
    'complaint' => 'complaints',
    'issue'     => 'issues',
    'confession'=> 'confessions'
];

if (!isset($tables[$type])) {
    http_response_code(400);
    exit("Invalid submit endpoint");
}

$table = $tables[$type];

// Insert safely
$stmt = $conn->prepare("INSERT INTO $table (name,message) VALUES (?,?)");
$stmt->bind_param("ss", $name, $message);
$stmt->execute();

header("Location: index.html"); // redirect back
exit;
?>
