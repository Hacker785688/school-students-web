<?php
// db.php - unified database connection and table creation

$host = "localhost";
$user = "portaluser";        // MySQL user
$pass = "StrongPassword";    // MySQL password
$db   = "student_portal";    // Database name

// Connect to MySQL
$conn = new mysqli($host, $user, $pass, $db);
if ($conn->connect_error) {
    http_response_code(500);
    die("Database connection failed: " . $conn->connect_error);
}

// Define all tables and their structure
$tables = [
    "confessions" => "CREATE TABLE IF NOT EXISTS confessions (
        id INT AUTO_INCREMENT PRIMARY KEY,
        name VARCHAR(100) DEFAULT 'Anonymous',
        message TEXT NOT NULL,
        submitted_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    )",
    "complaints" => "CREATE TABLE IF NOT EXISTS complaints (
        id INT AUTO_INCREMENT PRIMARY KEY,
        name VARCHAR(100) DEFAULT 'Anonymous',
        department VARCHAR(100) NOT NULL,
        message TEXT NOT NULL,
        submitted_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    )",
    "issues" => "CREATE TABLE IF NOT EXISTS issues (
        id INT AUTO_INCREMENT PRIMARY KEY,
        issue_type VARCHAR(100) NOT NULL,
        location VARCHAR(100) NOT NULL,
        description TEXT NOT NULL,
        submitted_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    )",
    "suggestions" => "CREATE TABLE IF NOT EXISTS suggestions (
        id INT AUTO_INCREMENT PRIMARY KEY,
        name VARCHAR(100) DEFAULT 'Anonymous',
        message TEXT NOT NULL,
        submitted_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    )"
];

// Create tables if missing
foreach ($tables as $name => $sql) {
    if (!$conn->query($sql)) {
        error_log("Error creating table $name: " . $conn->error);
    }
}
?>
